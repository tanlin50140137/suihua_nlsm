<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改商家信息</title>
    <link href="/public/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/public/static/css/font-awesome.min.css" rel="stylesheet">
    <link href="/public/static/css/admin.min.css" rel="stylesheet"/>
    <link href="/public/static/css/content.css" rel="stylesheet" />
    <link href="/public/static/css/image.css" rel="stylesheet" />
</head>
<body style="background:#ecf0f5;">
<section class="content">
<div class="nav-tabs-custom header-fixed">
    <ul class="nav nav-tabs">
        <li class="tab-item active"><a href="javascript:;">基本信息</a></li>
        <li class="tab-item"><a href="javascript:;">详情描述</a></li>
    </ul>
</div>

<form role="form" class="getform form-horizontal" method="post" id="form">
<div class="box box-solid">
    <div class="box box-solid getform">
        <div class="box-body">
            <div id="tabs">
                <table class="tab-member">
                    <tr class="rtd">
                        <td class="td-r">商家分类：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <select type="select" class="form-control pinput input-sm typeid" name="typeid">
                                    <option value="">==自营商家==</option>
                                    {volist name="type" id="vo"}
                                    <option value="{$vo['id']}" {if condition="$list.typeid == $vo['id']"}selected{/if}>{$vo['name']}</option>
                                    {/volist}
                                </select>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-r">商家名称：</td>
                        <td>
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control input-sm col-xs-12 pinput name" name="name" value="{$list.name}" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-r">收款人姓名：</td>
                        <td>
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control input-sm col-xs-12 pinput truename" name="truename" value="{$list.truename}" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-r">收款支付宝：</td>
                        <td>
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control input-sm col-xs-12 pinput alipay" name="alipay" value="{$list.alipay}" />
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">转账方式：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <div class="checkbox i-checks">
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="radio" value="1" name="is_take" class="is_take pinput hide" {if condition="$list.is_take == 1"}checked{/if}>
                                        </div> 
                                        <i></i> 秒结
                                    </label>
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="radio" value="2" name="is_take" class="is_take pinput hide" {if condition="$list.is_take == 2"}checked{/if}>
                                        </div> 
                                        <i></i> 按工作日
                                    </label>
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="radio" value="3" name="is_take" class="is_take pinput hide" {if condition="$list.is_take == 3"}checked{/if}>
                                        </div> 
                                        <i></i> 按金额
                                    </label>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-r">转账满足条件：</td>
                        <td>
                            <div class="col-xs-12 input-group-sm">
                                <input type="number" step="0.01" class="form-control input-sm col-xs-12 pinput take_money" name="take_money" value="{$list.take_money}" />
                            </div>
                        </td>
                    </tr>

                    <tr class="rtd">

                        <td class="td-r">商家折扣：</td>
                        <td colspan="3">
                            <div class="input-group input-200 input-group-sm">
                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                <input type="number" step="0.01" class="form-control pinput discount" name="discount" maxlength="10" value="{$list.discount}" />
                                <span class="input-group-addon">折</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">会员推荐返利：</td>
                        <td colspan="3">
                            <div class="input-group input-200 input-group-sm">
                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                <input type="number" step="0.01" class="form-control pinput huitui" name="huitui" maxlength="10" value="{$list.huitui}" />
                                <span class="input-group-addon">%</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">商家套餐：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <div class="checkbox i-checks">
                                    {volist name="setmeal" id="vo"}
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="checkbox" value="{$vo.id}" name="setmeal[]" class="setmeal pinput hide" {if condition="in_array($vo['id'],$list['setmeal'])"}checked{/if}>
                                        </div> 
                                        <i></i> {$vo.name}
                                    </label>
                                    {/volist}     
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-r">商家图片：</td>
                        <td>
                            <div class="col-xs-12 input-group-sm">
                                <div class="image-item">
                                    <img src="{$list.logo}" height="200px" class="logo" />
                                    <input id="file" type="file" class="hide form-control pinput file" name="logo" />
                                    <input type="hidden" class="form-control input-sm pinput" name="logo" value="{$list.logo}" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-r">轮播图片：</td>
                        <td>
                            <div class="col-xs-12 input-group-sm">
                                <div class="img-box full">
                                    <section class=" img-section">
                                        <div class="z_photo upimg-div clear" >
                                                {volist name="$list.image" id="vo"}
                                                <section class="up-section fl gallery-team">
                                                    <span class="up-span"></span>
                                                    <img class="close-upimg" src="/public/image/a7.png">
                                                    <img class="up-img" src="{$vo}">
                                                    <p class="img-name-p">{$vo}</p>
                                                    <div class="oper">
                                                        <span class="prev" onclick="gallery('prev', this)"><i class="fa fa-arrow-left"></i></span>
                                                        <span class="next" onclick="gallery('next', this)"><i class="fa fa-arrow-right"></i></span>
                                                    </div>
                                                </section>
                                                {/volist}
                                                <section class="z_file fl">
                                                    <img src="/public/image/a11.png" class="add-img">
                                                    <input type="file" name="file[]" id="image" class="file" accept="image/jpg,image/jpeg,image/png,image/bmp" />
                                                </section>
                                         </div>
                                     </section>
                                </div>
                                <aside class="mask works-mask">
                                    <div class="mask-content">
                                        <p class="del-p ">您确定要删除作品图片吗？</p>
                                        <p class="check-p"><span class="del-com wsdel-ok">确定</span><span class="wsdel-no">取消</span></p>
                                    </div>
                                </aside>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="td-r">营业执照：</td>
                        <td>
                            <div class="col-xs-12 input-group-sm">
                                <div class="image-item">
                                    <img src="{$list.license}" height="200px" class="logo" />
                                    <input id="file" type="file" class="hide form-control pinput file" name="license" />
                                    <input type="hidden" class="form-control input-sm pinput" name="license" value="{$list.license}" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">地址区域：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <select class="form-control re-area"></select>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">详细地址：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control pinput address" name="address" value="{$list.address}" />
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">商家排序：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <div class="input-group input-200 left">
                                    <input type="text" autocomplete="off"  class="form-control pinput sort" name="sort" value="{$list.address}" />
                                </div>
                                <div style="width:60px;float:left;text-align:center;line-height:30px;margin-left:60px;"><b>商家评分：</b></div>
                                <div class="input-group input-200 left">
                                    <input type="text" autocomplete="off"  class="form-control pinput star" name="star" value="{$list.star}" />
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">地图坐标：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <div class="input-group input-200 left">
                                   <input type="text" autocomplete="off"  class="form-control pinput landmark" name="landmark" id="landmark" value="{$list.landmark}" size="15" />
                                </div>
                                <div class="input-group input-200 left" style="margin-left:60px;">
                                    <a href="http://api.map.baidu.com/lbsapi/getpoint/index.html" target="_blank" class="btn btn-default">
                                        选取坐标
                                    </a>
                                </div>
                            </div>
                            <div class="col-xs-12 input-group-sm">
                                <span class="help-block">选取百度地图地理位置对应坐标</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">商家账号：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control pinput username" name="username" value="{$list.username}" readonly/>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">商家密码：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <input type="password" class="form-control pinput password" name="password" value="" />
                            </div>
                        </td>
                    </tr>

                    <tr class="rtd">
                        <td class="td-r">推荐会员：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control pinput pid" name="pid" value="{$list.pid}" />
                            </div>
                        </td>
                    </tr>

                    <tr class="rtd">
                        <td class="td-r">联系电话：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control pinput mobile" name="mobile" value="{$list.mobile}" />
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">服务热线：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control pinput hotline" name="hotline" value="{$list.hotline}" />
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">QQ客服：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <input type="text" autocomplete="off"  class="form-control pinput qq" name="qq" value="{$list.qq}" />
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">商家描述：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <textarea id="remark" rows="3" cols="100" name="remark" class="form-control pinput" style="height:100px;">{$list.remark}</textarea>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">商家状态：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <div class="checkbox i-checks">
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="radio" value="1" name="is_state" class="is_state pinput hide" {if condition="$list.is_state == 1"}checked{/if}>
                                        </div> 
                                        <i></i> 启用
                                    </label>
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="radio" value="2" name="is_state" class="is_state pinput hide" {if condition="$list.is_state == 2"}checked{/if}>
                                        </div> 
                                        <i></i> 禁用
                                    </label>
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="radio" value="3" name="is_state" class="is_state pinput hide" {if condition="$list.is_state == 3"}checked{/if}>
                                        </div> 
                                        <i></i> 待审核
                                    </label>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr class="rtd">
                        <td class="td-r">商家类型：</td>
                        <td colspan="3">
                            <div class="col-xs-12 input-group-sm">
                                <div class="checkbox i-checks">
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="radio" value="1" name="type" class="type pinput hide" {if condition="$list.type == 1"}checked{/if}>
                                        </div> 
                                        <i></i> 个体商户
                                    </label>
                                    <label class="">
                                        <div class="icheckbox_square-green">
                                            <input type="radio" value="2" name="type" class="type pinput hide" {if condition="$list.type == 2"}checked{/if}>
                                        </div> 
                                        <i></i> 企业商户
                                    </label>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="tabs">
                <input type="hidden" class="content" name="content" value="">
                <script id="content" name="content" type="text/plain" style="width:100%;height:600px;"></script>
            </div>
        </div>
    </div>
    <div class="footer">
        <button class="btn btn-primary btn-sm btn-flat" type="submit">保存修改</button>
    </div>
</div>
<input type="hidden" name="id" value="{$list.id}">
<input type="hidden" class="city" name="city" value="">
<input type="hidden" class="cityid" name="cityid" value="">
<input type="hidden" class="image" name="image" value="">
</form>
</section>
<script src="/public/static/js/jquery-1.8.3.min.js"></script>

<!-- 选项框插件 -->
<link href="/public/plugins/iCheck/custom.css" rel="stylesheet">
<script src="/public/plugins/iCheck/icheck.min.js"></script>
<!-- 弹框插件 -->
<link rel="stylesheet" href="/public/static/css/common.css">
<script src="/public/static/js/common.js"></script>

<script src="/public/plugins/ueditor/ueditor.config.js"></script>
<script src="/public/plugins/ueditor/ueditor.all.js"></script>
<script src="/public/plugins/ueditor/ueditor.parse.js"></script>
<script src="/public/static/js/region-list.js"></script>
<script src="/public/static/js/image.js"></script>
<script type="text/javascript" src="/public/plugins/My97DatePicker/WdatePicker.js"></script>
<script>
    $(document).ready(function(){$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",})});
</script>
<script>
window.UEDITOR_CONFIG.serverUrl = '__MODULE__'+window.UEDITOR_CONFIG.serverUrl;
$(function() {
    UE.getEditor('content', {
        toolbars: [
             ['fullscreen', 'source', 'undo', 'redo', 'bold', 'italic', 'underline', 'fontborder', 'backcolor', 'fontsize', 'fontfamily', 'justifyleft', 'justifyright', 'justifycenter', 'justifyjustify', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', 'selectall', 'cleardoc', 'link', 'unlink', 'emotion', 'simpleupload', 'insertimage','insertvideo', 'help']
        ]
    });
    UE.getEditor('content').ready(function() {
        UE.getEditor('content').setContent('{$list.content}');
    });

    //地区选择初始化
    var rs = new regions('.re-area', "{$list['cityid']}", 5, 1, 'edit');
        rs.init();

    $("#form").submit(function(){  
         // 验证用户输入数据
        var name = $(".name").val();    
        var password = $(".password").val();    
        if(name.length<1){
            bpop.tip('请输入商家名称！', 2, 1);return false;
        }else if(password.length > 1 && (password.length<6  || password.length>18)){
            bpop.tip('请输入6-18位数之间商家密码！', 2, 1);return false;
        }
        var cityid = 0;
        var address = Array();
        $('body .re-area').each(function() {
            if ($(this).val() > 0) {
                cityid = $(this).val();
                address.push($(this).find(':selected').text());
            }else{
                bpop.tip("请选择完整地区！",2,1);
                return false;
            }
        });
        var city = address.join('-');
        $(".city").val(city);
        $(".cityid").val(cityid);
        var content = UE.getEditor('content').getContent();
        $(".content").val(content);
        var image = Array();
        $('body .up-img').each(function() {
            image.push($(this).attr('src'));
        });
        var image = image.join('、');
        $(".image").val(image);

        var formData = new FormData($("#form")[0]); 
        bpop.addLoading(true);
        $.ajax({ 
            url: '__MODULE__/Business/edit', 
            type: 'POST',
            data: formData, 
            async: false, 
            cache: false, 
            contentType: false, 
            processData: false, 
            success: function (data) { 
                if (data.success == true) {
                    bpop.tip(data.info, 1, 1);
                }else{
                    bpop.tip(data.info, 2, 1);
                }
            }, 
            dataType:'json' 
        });
        return false; 
    }); 
});
</script>
</body>
</html>